!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.shear=n()}(this,function(){"use strict";var A=!("modify"in window.getSelection());function H(e){return[].slice.call(e)}function L(e){var n=[];return e.nodeType===Node.TEXT_NODE&&n.push(e),H(e.childNodes).map(function(e){n=n.concat(L(e))}),n}function M(e,n,t,r){return void 0===n&&(n=""),void 0===t&&(t=""),void 0===r&&(r=""),{isCuted:e,fullHTML:n,cutedHTML:t,cutedWithAfterHTML:r}}return function(r,e,n){if(void 0===e&&(e=2),void 0===n&&(n=null),!r.childNodes.length)return M(!1);var t,i,o,d,c,l,a,u=window.getSelection(),f=r.innerHTML,g=r.getBoundingClientRect().height;if(u.collapse(r,0),A)i=r,o=e,d=document.createRange(),c=L(i),l=null,a=0,d.setStart(c[0],0),function(){for(var e=0;e<c.length;e++)for(var n=0;n<c[e].length;n++){d.setEnd(c[e],n);var t=d.getBoundingClientRect().height;if(null===l&&(l=t),t!==l&&(a++,l=t),o<a)return d.setStart(c[e],n),d.setEnd(c[e],n)}}(),t=d;else{for(var s=0;s<e;s++)if(u.modify("extend","right","character"),u.modify("extend","right","lineboundary"),!r.contains(u.focusNode)){u.selectAllChildren(r);break}u.collapseToEnd(),t=u.getRangeAt(0).cloneRange()}u.selectAllChildren(r),t.setEnd(u.getRangeAt(0).endContainer,u.getRangeAt(0).endOffset),t.cloneRange().deleteContents();var h=r.innerHTML,v=f!==h,m=h,R=r.getBoundingClientRect().height;if(R<g&&n){var p=function(e){var n=document.createElement("DIV");n.innerHTML=e;var t=document.createDocumentFragment();return H(n.childNodes).forEach(function(e){return t.appendChild(e)}),t}(n),C=L(r),T=C[C.length-1],E=T.length,y=document.createRange();y.setStart(T,E),y.setEnd(T,E),y.insertNode(p),function(){for(var e=C.length-1;0<=e;e--)for(var n=C[e].length-1;0<=n;n--){if(r.getBoundingClientRect().height<=R)return;var t=document.createRange();t.setStart(C[e],n),t.setEnd(C[e],n+1),t.deleteContents()}}(),m=r.innerHTML}return u.removeAllRanges(),M(v,f,h,m)}});
